# 実装ステップ計画書（TDD版）

## 📌 実装方針
- **Test-Driven Development (TDD)** で進める
- 各機能は「テスト作成 → 実装 → リファクタリング」のサイクル
- 小さな単位で段階的に実装

## 🎯 実装優先順位

### Phase 1: 基礎構築
#### 1.1 データモデル定義
- [ ] TypeScript型定義の作成
  - Vote, Group, Result, Config の型
  - テスト: 型の整合性チェック
  
#### 1.2 ユーティリティ関数
- [ ] 端末ID管理（localStorage）
  - テスト: ID生成、保存、取得の動作確認
- [ ] 日付フォーマット関数
  - テスト: タイムスタンプ変換の正確性

### Phase 2: 投票機能（コア機能）
#### 2.1 Firestoreサービス層
- [ ] 団体リスト取得機能
  - テスト: モックデータでの取得確認
  - テスト: エラーハンドリング
  
#### 2.2 投票処理
- [ ] 投票の重複チェック機能
  - テスト: 同一端末・同一団体での重複防止
  - テスト: 異なる団体への投票許可
- [ ] 投票データ保存機能
  - テスト: 正常系の保存確認
  - テスト: バリデーションエラー

#### 2.3 投票フォームUI
- [ ] 投票フォームコンポーネント
  - テスト: フォーム入力・送信の動作
  - テスト: エラー表示
  - テスト: 成功時のフィードバック

### Phase 3: 集計・表示機能
#### 3.1 集計結果取得
- [ ] resultsコレクション取得機能
  - テスト: データ取得とソート
  - テスト: 空データ時の処理

#### 3.2 ランキング表示
- [ ] ランキングコンポーネント
  - テスト: 順位表示の正確性
  - テスト: リアルタイム更新（1分ごと）
  - テスト: 「集計中...」表示

#### 3.3 レスポンシブ対応
- [ ] モバイルビューの最適化
  - テスト: 各画面サイズでの表示確認

### Phase 4: 集計処理（バックエンド）
#### 4.1 集計ロジック
- [ ] 投票データ集計関数
  - テスト: 合計点計算の正確性
  - テスト: ランキング計算
  
#### 4.2 定期実行設定
- [ ] Cloud Functions設定（または代替手段）
  - テスト: 1分ごとの実行確認
  - テスト: 並行処理の安全性

### Phase 5: 管理者機能
#### 5.1 認証システム
- [ ] Firebase Authentication統合
  - テスト: ログイン・ログアウト
  - テスト: 権限チェック

#### 5.2 管理画面
- [ ] 団体管理（CRUD）
  - テスト: 追加・編集・削除の動作
- [ ] 投票履歴表示
  - テスト: フィルタリング・検索
- [ ] 設定管理
  - テスト: 設定変更の反映

## 📋 各フェーズの実装詳細

### Phase 1 実装詳細（2-3日）
```typescript
// types/index.ts - 型定義
interface Vote {
  id?: string;
  groupId: string;
  score: number;
  deviceId: string;
  createdAt: Date;
}

interface Group {
  id: string;
  name: string;
  createdAt?: Date;
}

interface Result {
  groupId: string;
  groupName: string;
  totalScore: number;
  rank: number;
  updatedAt: Date;
}
```

### Phase 2 実装詳細（3-4日）
- 投票フォーム実装
- 重複投票防止ロジック
- エラーハンドリング

### Phase 3 実装詳細（2-3日）
- リアルタイム更新機能
- ランキング表示
- UX改善

### Phase 4 実装詳細（2日）
- 集計処理の実装
- パフォーマンス最適化

### Phase 5 実装詳細（3-4日）
- 管理者認証
- 管理画面UI
- セキュリティ強化

## 🔧 テスト環境構築
```bash
# テストライブラリのインストール
npm install --save-dev @testing-library/react @testing-library/jest-dom jest jest-environment-jsdom

# Firestore エミュレータ（ローカルテスト用）
npm install --save-dev @firebase/rules-unit-testing
```

## 📊 完了基準
- [ ] 全テストがパス
- [ ] カバレッジ80%以上
- [ ] Lighthouse スコア90以上（モバイル）
- [ ] Security Rules適用済み
- [ ] 本番環境デプロイ可能

## ⏱️ 想定スケジュール
- **全体期間**: 約2-3週間
- **Phase 1-2**: 1週間（コア機能）
- **Phase 3-4**: 4-5日（表示・集計）
- **Phase 5**: 3-4日（管理機能）

## 次のアクション
1. テスト環境のセットアップ
2. Phase 1.1 の型定義とテストから開始